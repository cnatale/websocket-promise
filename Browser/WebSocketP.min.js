"use strict";function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function(e,t,n){for(var r=!0;r;){var i=e,o=t,s=n;a=c=u=void 0,r=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var u=a.get;return void 0===u?void 0:u.call(s)}var c=Object.getPrototypeOf(i);if(null===c)return void 0;e=c,t=o,n=s,r=!0}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),EventEmitter=function(){function e(){_classCallCheck(this,e),this.Events={}}return _createClass(e,[{key:"on",value:function(e,t){return this.__validate(e,t),this.Events[e].push(t),this}},{key:"once",value:function(e,t){var n=this;return this.__validate(e,t),this.Events[e].push(function r(){n.off(e,r),t.apply(n,arguments)}),this}},{key:"off",value:function(e,t){if("string"!=typeof e)throw new Error("Invalid Arguments");if(this.Events[e]||(this.Events[e]=[]),"function"==typeof t){var n=this.Events[e].indexOf(t);-1!==n&&this.Events[e].splice(n,1)}else"undefined"==typeof t&&(this.Events[e]=[]);return this}},{key:"emit",value:function(e){var t=arguments,n=this;if("string"!=typeof e)throw new Error("Invalid Arguments");return this.Events[e]||(this.Events[e]=[]),this.Events[e].length&&!function(){var r=Array.prototype.slice.call(t,1),i=n;n.Events[e].forEach(function(e){e.apply(i,r)})}(),this}},{key:"__validate",value:function(e,t){if("string"!=typeof e||"function"!=typeof t)throw new Error("Invalid Arguments");this.Events[e]||(this.Events[e]=[])}}]),e}();EventEmitter.prototype.addEventListener=EventEmitter.prototype.on,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.removeEventListener=EventEmitter.prototype.off,EventEmitter.prototype.removeListener=EventEmitter.prototype.off,window.EventEmitter=EventEmitter;var WebSocketP=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var n=this;this.Connection=new WebSocket(e),this.Connection.addEventListener("message",function(e){try{if(e=JSON.parse(e.data),!e.EXCHANGE)throw null}catch(t){return n.emit("ParseError",e)}"Request"===e.Type?(e.Result=null,n.emit(e.SubType,e.Message,e),n.emit("All",e.Message,e)):"Broadcast"===e.Type?(n.emit(e.SubType,e.Message,e),n.emit("All",e.Message,e)):"Reply"===e.Type&&n.emit("JOB:"+e.ID,e.Message)})}return _inherits(t,e),_createClass(t,[{key:"Send",value:function(e,t){return t=t||"",this.Connection.send(JSON.stringify({Type:"Broadcast",SubType:e,Message:t,Exchange:!0})),this}},{key:"Request",value:function(e,t){t=t||"";var n=this;return new Promise(function(r){var i=(Math.random().toString(36)+"00000000000000000").slice(2,9);n.once("JOB:"+i,r),n.Connection.send(JSON.stringify({Type:"Request",SubType:e,Message:t,ID:i,EXCHANGE:!0}))})}},{key:"Finished",value:function(e){this.Connection.send(JSON.stringify({Type:"Reply",ID:e.ID,Message:e.Result,EXCHANGE:!0}))}},{key:"Terminate",value:function(){this.Connection.close()}}]),t}(EventEmitter);window.WebSocketP=WebSocketP;